<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">
<head>
  <title>Seance Scheduling</title>
</head>
<body>

<div layout:fragment="content">
  <div class="container mx-auto px-6 py-12 max-w-2xl">

    <!-- Header Section: Main title for the seance creation interface -->
    <h1 class="text-3xl font-bold font-serif text-white mb-8 border-l-4 border-cinema-accent pl-4 uppercase tracking-wider">
      Schedule New Seance
    </h1>

    <!-- Error Notification: Displayed when server-side validation fails -->
    <div th:if="${error}" class="bg-red-900/50 border border-red-500 text-red-200 p-4 rounded mb-6 flex items-center">
      <i class="fas fa-exclamation-triangle mr-3 text-xl"></i>
      <span th:text="${error}">Validation Error</span>
    </div>

    <!--
        Seance Creation Form
        Handles movie selection, room assignment, timing, and pricing
    -->
    <form th:action="@{/admin/seances/add}" th:object="${seance}" method="post"
          class="space-y-6 bg-cinema-dark p-8 rounded-xl border border-gray-800 shadow-2xl">

      <!-- Movie Selection -->
      <div>
        <label class="block text-gray-400 mb-2 text-sm uppercase font-semibold">Select Movie</label>
        <select th:field="*{movieId}" required
                class="w-full bg-black border border-gray-700 rounded p-3 text-white focus:border-cinema-accent focus:outline-none transition">
          <option value="" disabled selected>-- Select a movie from the list --</option>
          <option th:each="movie : ${movies}"
                  th:value="${movie.id}"
                  th:text="${movie.title} + ' (' + ${movie.durationMin} + ' min)'">Movie Title</option>
        </select>
        <p class="text-xs text-gray-500 mt-2 italic">End time will be calculated automatically based on the movie duration.</p>
      </div>

      <!-- Cinema Room Selection -->
      <div>
        <label class="block text-gray-400 mb-2 text-sm uppercase font-semibold">Select Room</label>
        <select th:field="*{roomId}" required
                class="w-full bg-black border border-gray-700 rounded p-3 text-white focus:border-cinema-accent focus:outline-none transition">
          <option value="" disabled selected>-- Select a cinema hall --</option>
          <option th:each="room : ${rooms}"
                  th:value="${room.id}"
                  th:text="${room.name}">Hall 1</option>
        </select>
      </div>

      <!-- Scheduling: Start Date and Time -->
      <div>
        <label class="block text-gray-400 mb-2 text-sm uppercase font-semibold">Start Date & Time</label>
        <input type="datetime-local" th:field="*{startTime}" required
               class="w-full bg-black border border-gray-700 rounded p-3 text-white focus:border-cinema-accent focus:outline-none appearance-none">
      </div>

      <!-- Pricing Configuration -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label class="block text-gray-400 mb-2 text-sm uppercase font-semibold">Regular Ticket Price</label>
          <div class="relative">
            <input type="number" step="0.01" th:field="*{regularTicketPrice}" required placeholder="0.00"
                   class="w-full bg-black border border-gray-700 rounded p-3 text-white focus:border-cinema-accent focus:outline-none">
          </div>
        </div>
        <div>
          <label class="block text-gray-400 mb-2 text-sm uppercase font-semibold">Reduced Ticket Price</label>
          <div class="relative">
            <input type="number" step="0.01" th:field="*{reducedTicketPrice}" required placeholder="0.00"
                   class="w-full bg-black border border-gray-700 rounded p-3 text-white focus:border-cinema-accent focus:outline-none">
          </div>
        </div>
      </div>

      <!-- Form Global Actions -->
      <div class="flex justify-end gap-4 pt-6 border-t border-gray-800">
        <a th:href="@{/admin/seances}" class="px-6 py-3 rounded border border-gray-600 text-gray-400 hover:text-white hover:border-white transition no-underline">
          Cancel
        </a>
        <button type="submit" class="bg-cinema-accent hover:bg-cinema-accentHover text-white px-8 py-3 rounded font-bold transition shadow-lg cursor-pointer border-0">
          <i class="fas fa-calendar-check mr-2"></i> Create Seance
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  /**
   * Seance Form Management
   */
  document.addEventListener('DOMContentLoaded', () => {
    console.log('Seance scheduling form initialized.');

    /**
     * Real-time validation for start time
     * Ensures seances aren't scheduled in the past
     */
    const startTimeInput = document.querySelector('input[type="datetime-local"]');
    if (startTimeInput) {
      const now = new Date().toISOString().slice(0, 16);
      startTimeInput.setAttribute('min', now);
    }
  });
</script>

</body>
</html>
