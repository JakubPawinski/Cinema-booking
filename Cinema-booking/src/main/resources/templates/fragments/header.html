<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<body>

<!--
    Global Navigation Header Fragment
-->
<nav th:fragment="header-nav" id="mainNav" class="fixed w-full z-50 transition-all duration-300 border-b border-white/5 py-4">
    <div class="container mx-auto px-6 flex justify-between items-center">

        <!-- Application Logo & Branding -->
        <a href="/" class="text-2xl md:text-3xl font-serif font-bold italic tracking-wider flex items-center gap-2 group no-underline">
            <i class="fas fa-film text-cinema-accent group-hover:rotate-12 transition transform"></i>
            <span class="text-white">CINEMA</span><span class="text-cinema-accent drop-shadow-[0_0_8px_rgba(147,51,234,0.5)]">BOOKING</span>
        </a>

        <!-- Main Navigation Links: Visible only for authenticated users -->
        <div sec:authorize="isAuthenticated()" class="hidden md:flex items-center space-x-8 text-sm font-semibold uppercase tracking-wide">
            <a href="/movies" class="text-gray-300 hover:text-cinema-accent transition relative group no-underline">
                Movies
                <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-cinema-accent transition-all group-hover:w-full"></span>
            </a>

            <!-- Admin Access: Conditional rendering based on ROLE_ADMIN -->
            <a sec:authorize="hasRole('ADMIN')" href="/admin" class="text-cinema-gold hover:text-white transition flex items-center gap-2 no-underline">
                <i class="fas fa-shield-alt"></i> Admin Panel
            </a>
        </div>

        <!-- User Actions Section -->
        <div class="flex items-center gap-4">

            <!-- Anonymous User: Login Prompt -->
            <div sec:authorize="!isAuthenticated()" class="flex gap-4">
                <a href="/login" class="bg-cinema-accent hover:bg-cinema-accentHover text-white px-5 py-2 rounded-full font-bold text-sm transition transform hover:scale-105 shadow-lg shadow-purple-900/40 no-underline">
                    Login
                </a>
            </div>

            <!-- Authenticated User: Profile Dropdown -->
            <div sec:authorize="isAuthenticated()" class="dropdown">
                <button class="bg-transparent border-0 flex items-center gap-2 text-white hover:text-cinema-accent transition dropdown-toggle cursor-pointer" type="button" data-bs-toggle="dropdown">
                    <span class="font-semibold hidden sm:inline" sec:authentication="name">User</span>
                    <i class="fas fa-user-circle text-xl"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-dark bg-cinema-dark border border-gray-700 shadow-2xl mt-3 rounded-xl overflow-hidden p-0">
                    <li>
                        <a class="dropdown-item py-3 hover:bg-cinema-accent transition-colors" href="/profile">
                            <i class="fas fa-id-card mr-2 scale-90"></i> My profile
                        </a>
                    </li>
                    <li><hr class="dropdown-divider border-gray-700 my-0"></li>
                    <li>
                        <!-- Logout Implementation via CSRF-compliant Post Request -->
                        <form th:action="@{/logout}" method="post">
                            <button type="submit" class="dropdown-item py-3 text-red-400 hover:bg-red-900/30 transition-colors w-full text-left cursor-pointer border-0 bg-transparent">
                                <i class="fas fa-sign-out-alt mr-2 scale-90"></i> Logout
                            </button>
                        </form>
                    </li>
                </ul>
            </div>

        </div>
    </div>
</nav>

</body>
</html>
